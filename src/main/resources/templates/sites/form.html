<html lang="ru" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout(~{::title}, 'customers', ~{::content}, ~{::extraHead}, ~{::extraScripts})}">
<head>
    <title th:text="${isEdit} ? 'Редактирование объекта' : 'Новый объект'">Объект</title>
    <th:block th:fragment="extraHead"></th:block>
</head>
<body>
<th:block th:fragment="content">
    <div class="d-flex justify-content-between align-items-start mb-3">
        <div>
            <p class="text-muted mb-1" th:text="${customer.name}">Заказчик</p>
            <h1 class="h4" th:text="${isEdit} ? 'Редактирование объекта' : 'Новый объект'"></h1>
        </div>
        <a class="btn btn-outline-secondary" th:href="@{'/customers/' + ${customer.id}}">Назад к заказчику</a>
    </div>

    <div class="card shadow-sm">
        <div class="card-body">
            <div th:if="${error != null}" class="alert alert-danger" th:text="${error}"></div>
            <form th:action="${isEdit} ? '/sites/' + ${siteId} : '/customers/' + ${customer.id} + '/sites'" method="post">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">Наименование *</label>
                        <input type="text" class="form-control" name="name" th:value="${siteForm.name}" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Адрес</label>
                        <input type="text" class="form-control" name="fullAddress" th:value="${siteForm.fullAddress}">
                    </div>
                    <div class="col-12">
                        <label class="form-label">Описание</label>
                        <textarea class="form-control" name="description" rows="3" th:text="${siteForm.description}"></textarea>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Широта</label>
                        <input type="number" step="any" class="form-control" name="latitude" th:value="${siteForm.latitude}">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Долгота</label>
                        <input type="number" step="any" class="form-control" name="longitude" th:value="${siteForm.longitude}">
                    </div>
                    <div class="col-12">
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="useCustomerContact" name="useCustomerContact" value="true" th:checked="${siteForm.useCustomerContact}">
                            <label class="form-check-label" for="useCustomerContact">Использовать контакт заказчика</label>
                        </div>
                        <div id="contactFields" class="row g-3" th:classappend="${siteForm.useCustomerContact} ? ' d-none' : ''">
                            <div class="col-md-6">
                                <label class="form-label">Контактное лицо</label>
                                <input type="text" class="form-control" name="contactName" th:value="${siteForm.contactName}">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Должность</label>
                                <input type="text" class="form-control" name="contactPosition" th:value="${siteForm.contactPosition}">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Телефон</label>
                                <input type="text" class="form-control" name="contactPhone" th:value="${siteForm.contactPhone}">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control" name="contactEmail" th:value="${siteForm.contactEmail}">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="d-flex justify-content-between mt-4">
                    <a class="btn btn-outline-secondary" th:href="${isEdit} ? '/sites/' + ${siteId} : '/customers/' + ${customer.id}">Отмена</a>
                    <button type="submit" class="btn btn-primary">Сохранить</button>
                </div>
            </form>
        </div>
    </div>
</th:block>
<th:block th:fragment="extraScripts">
    <script>
        const checkbox = document.getElementById('useCustomerContact');
        const contactFields = document.getElementById('contactFields');
        function toggleContact() {
            if (!checkbox || !contactFields) return;
            contactFields.classList.toggle('d-none', checkbox.checked);
        }
        if (checkbox) {
            checkbox.addEventListener('change', toggleContact);
            toggleContact();
        }
    </script>
</th:block>
</body>
</html>
