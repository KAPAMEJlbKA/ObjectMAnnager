<html lang="ru" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout(~{::title}, 'customers', ~{::content}, ~{::extraHead}, ~{::extraScripts})}">
<head>
    <title th:text="${calculation.name} + ' — редактирование схемы'">Мастер расчёта</title>
    <th:block th:fragment="extraHead">
        <link rel="stylesheet" href="/css/topology.css">
    </th:block>
</head>
<body>
<th:block th:fragment="content">
    <div class="mb-3">
        <p class="text-muted mb-1">Мастер расчёта — шаг 3 из 7</p>
        <div class="progress" role="progressbar" aria-valuenow="43" aria-valuemin="0" aria-valuemax="100">
            <div class="progress-bar" style="width: 43%"></div>
        </div>
    </div>

    <div class="om-page-card om-topology-editor" th:attr="data-calc-id=${calculation.id}">
        <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
                <h1 class="h5 mb-1">Редактор схемы</h1>
                <p class="mb-0 text-muted">
                    <span th:text="${calculation.name}"></span>
                    — <a class="text-decoration-none" th:href="@{'/sites/' + ${calculation.site.id}}" th:text="${calculation.site.name}"></a>
                </p>
            </div>
            <div class="d-flex align-items-center gap-2">
                <div class="btn-group btn-group-sm" role="group" aria-label="Режимы редактора">
                    <button type="button" class="btn btn-outline-secondary active" data-mode="select" id="mode-select">Выделение</button>
                    <button type="button" class="btn btn-outline-secondary" data-mode="connect" id="mode-connect">Соединение</button>
                </div>
                <a class="btn btn-outline-secondary" th:href="@{'/calculations/' + ${calculation.id} + '/wizard/step2'}">Назад</a>
                <a class="btn btn-primary" th:href="@{'/calculations/' + ${calculation.id} + '/wizard/step4'}">Далее</a>
            </div>
        </div>

        <div class="d-flex" style="height: 600px;">
            <!-- Левая панель: список устройств -->
            <div class="om-topology-side om-topology-side-left">
                <h3 class="h6 mb-2">Устройства</h3>
                <div id="device-list" class="om-topology-list"></div>
            </div>

            <!-- Центр: холст -->
            <div class="om-topology-canvas-wrapper flex-grow-1 mx-3">
                <svg id="topology-links-layer"></svg>
                <div id="topology-nodes-layer"></div>
            </div>

            <!-- Правая панель: инспектор -->
            <div class="om-topology-side om-topology-side-right">
                <h3 class="h6 mb-2">Свойства</h3>
                <div id="inspector-empty" class="text-muted small">
                    Выберите узел, устройство или линию.
                </div>
                <div id="inspector-content" class="d-none"></div>
            </div>
        </div>
    </div>
</th:block>
<th:block th:fragment="extraScripts">
    <script src="/js/topology.js"></script>
</th:block>
</body>
</html>
