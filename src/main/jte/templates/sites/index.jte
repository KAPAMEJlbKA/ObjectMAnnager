@import com.kapamejlbka.objectmannage.domain.Site
@import org.springframework.data.domain.Page
@import org.springframework.security.web.csrf.CsrfToken
@import java.time.ZoneId
@import java.time.format.DateTimeFormatter

@param Page<Site> sitesPage
@param String q = null
@param CsrfToken _csrf
@param String flashSuccess = null
@param String flashError = null

<% DateTimeFormatter createdAtFormatter = DateTimeFormatter.ofPattern("dd.MM.yyyy HH:mm")
        .withZone(ZoneId.systemDefault()); %>

@templates.layout(
        title = "–ü–ª–æ—â–∞–¥–∫–∏",
        activePage = "sites",
        flashSuccess = flashSuccess,
        flashError = flashError
) {
    <section class="page-card">
        <div class="page-header">
            <div>
                <p class="eyebrow">–ê–¥—Ä–µ—Å–∞ –æ–±—ä–µ–∫—Ç–æ–≤</p>
                <h1 class="page-title">–ü–ª–æ—â–∞–¥–∫–∏</h1>
                <p class="page-subtitle">–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –≥–æ—Ä–æ–¥—É –∏–ª–∏ –∞–¥—Ä–µ—Å—É. –£–ø—Ä–∞–≤–ª—è–π—Ç–µ –ø–ª–æ—â–∞–¥–∫–∞–º–∏ –∏ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ.</p>
            </div>
            <a class="button primary" href="/sites/new">–î–æ–±–∞–≤–∏—Ç—å –ø–ª–æ—â–∞–¥–∫—É</a>
        </div>

        <div class="filter-panel">
            <form method="get" action="/sites" class="filter-grid single">
                <label class="filter-field">
                    <span>–ü–æ–∏—Å–∫</span>
                    <input type="text" name="q" value="@(q == null ? "" : q)" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –≥–æ—Ä–æ–¥—É –∏–ª–∏ –∞–¥—Ä–µ—Å—É">
                </label>
                <div class="filter-actions">
                    <button type="submit" class="button">–ù–∞–π—Ç–∏</button>
                    @if(q != null && !q.isBlank()) {
                        <a class="button ghost" href="/sites">–°–±—Ä–æ—Å–∏—Ç—å</a>
                    }
                </div>
            </form>
        </div>

        @if(sitesPage.isEmpty()) {
            <div class="empty-state">
                <div class="empty-icon">üìç</div>
                <div>
                    <h3>–ü–ª–æ—â–∞–¥–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                    <p class="muted">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –ø–ª–æ—â–∞–¥–∫—É.</p>
                </div>
            </div>
        } else {
            <div class="table-card">
                <div class="table-scroll">
                    <table class="data-table">
                        <thead>
                        <tr>
                            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                            <th>–ì–æ—Ä–æ–¥</th>
                            <th>–ê–¥—Ä–µ—Å</th>
                            <th>–ö–æ–Ω—Ç–∞–∫—Ç</th>
                            <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                            <th>–°–æ–∑–¥–∞–Ω–æ</th>
                            <th class="actions-col"></th>
                        </tr>
                        </thead>
                        <tbody>
                        @for(Site site : sitesPage.getContent()) {
                            <tr>
                                <td>
                                    <div class="cell-main">@site.getName()</div>
                                    <div class="cell-sub">@site.getId()</div>
                                </td>
                                <td>@(site.getCity() == null ? "‚Äî" : site.getCity())</td>
                                <td>@(site.getAddress() == null ? "‚Äî" : site.getAddress())</td>
                                <td>@(site.getContactName() == null ? "‚Äî" : site.getContactName())</td>
                                <td>@(site.getContactPhone() == null ? "‚Äî" : site.getContactPhone())</td>
                                <td>@createdAtFormatter.format(site.getCreatedAt())</td>
                                <td class="row-actions">
                                    <a class="button ghost" href="/sites/@site.getId()/edit">–ò–∑–º–µ–Ω–∏—Ç—å</a>
                                    <form method="post" action="/sites/@site.getId()/delete">
                                        <input type="hidden" name="@_csrf.getParameterName()" value="@_csrf.getToken()">
                                        <button type="submit" class="button danger">–£–¥–∞–ª–∏—Ç—å</button>
                                    </form>
                                </td>
                            </tr>
                        }
                        </tbody>
                    </table>
                </div>
                @templates.fragments.pagination(page = sitesPage, basePath = "/sites", query = q)
            </div>
        }
    </section>
}
